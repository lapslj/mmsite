<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Flipbook</title>
    <!-- Load dependencies with specific versions -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel/7.22.20/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .debug-info {
            position: fixed;
            bottom: 0;
            left: 0;
            background: #f0f0f0;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- Add a debug div -->
    <div id="debug" class="debug-info">Loading...</div>
    <div id="flipbook-root"></div>

    <script type="text/babel">
        // Debug helper
        const debug = (message) => {
            const debugDiv = document.getElementById('debug');
            debugDiv.innerHTML += '<br>' + message;
        };

        debug('Script started');

        const { useState, useEffect } = React;

        const PDFFlipbook = () => {
            const [currentPage, setCurrentPage] = useState(1);
            const [totalPages, setTotalPages] = useState(1);
            const [error, setError] = useState(null);
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                debug('Component mounted');
                
                // Initialize PDF.js with explicit worker
                const workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                pdfjsLib.GlobalWorkerOptions.workerSrc = workerSrc;
                
                debug('PDF.js worker initialized');

                // Replace this with your PDF URL - start with a test PDF
                const pdfUrl = 'https://raw.githubusercontent.com/mozilla/pdf.js/ba2edeae/examples/learning/helloworld.pdf';
                
                loadPDF(pdfUrl);
            }, []);

            const loadPDF = async (url) => {
                debug('Starting to load PDF from: ' + url);
                try {
                    const loadingTask = pdfjsLib.getDocument(url);
                    debug('PDF loading task created');
                    
                    const pdf = await loadingTask.promise;
                    debug('PDF loaded successfully');
                    
                    setTotalPages(pdf.numPages);
                    setIsLoading(false);
                    debug('Total pages: ' + pdf.numPages);
                } catch (error) {
                    debug('Error loading PDF: ' + error.message);
                    setError(error.message);
                    setIsLoading(false);
                }
            };

            const goToPreviousPage = () => {
                if (currentPage > 1) {
                    setCurrentPage(currentPage - 1);
                }
            };

            const goToNextPage = () => {
                if (currentPage < totalPages) {
                    setCurrentPage(currentPage + 1);
                }
            };

            return (
                <div className="w-full max-w-4xl mx-auto p-4">
                    <div className="relative bg-white rounded-lg shadow-lg">
                        <div className="relative aspect-[3/4] w-full bg-gray-50 rounded-lg overflow-hidden">
                            {isLoading ? (
                                <div className="absolute inset-0 flex items-center justify-center">
                                    Loading PDF...
                                </div>
                            ) : error ? (
                                <div className="absolute inset-0 flex items-center justify-center text-red-500">
                                    Error: {error}
                                </div>
                            ) : (
                                <div className="absolute inset-0 flex items-center justify-center text-4xl font-bold text-gray-300">
                                    Page {currentPage}
                                </div>
                            )}

                            <div className="absolute inset-x-0 bottom-0 flex justify-between p-4">
                                <button
                                    onClick={goToPreviousPage}
                                    disabled={currentPage === 1}
                                    className="p-2 rounded-full bg-gray-200"
                                >
                                    Previous
                                </button>
                                <span className="flex items-center text-gray-600">
                                    Page {currentPage} of {totalPages}
                                </span>
                                <button
                                    onClick={goToNextPage}
                                    disabled={currentPage === totalPages}
                                    className="p-2 rounded-full bg-gray-200"
                                >
                                    Next
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        debug('Attempting to render component');
        try {
            ReactDOM.render(<PDFFlipbook />, document.getElementById('flipbook-root'));
            debug('Component rendered successfully');
        } catch (error) {
            debug('Error rendering component: ' + error.message);
        }
    </script>
</body>
</html>
